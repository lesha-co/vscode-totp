{"version":3,"sources":["../webpack/bootstrap","../external \"vscode\"",".././src/store/versions/auto.ts",".././src/store/context.ts",".././src/commands.ts",".././src/buttons.ts",".././node_modules/simple-totp/dist/index.js",".././node_modules/simple-totp/dist/getKey.js",".././node_modules/simple-totp/dist/base32decode.js",".././node_modules/simple-totp/dist/getCode.js",".././node_modules/simple-totp/dist/getCounter.js",".././node_modules/simple-totp/dist/getHMAC.js","../external \"crypto\"",".././src/extension.ts",".././src/commands/pick.ts",".././src/pickOTP.ts",".././src/store/index.ts",".././node_modules/simple-totp/dist/getTOTP.js",".././src/store/versions/v1.ts",".././src/store/askForEncryptionPassword.ts",".././src/store/crypto.ts",".././src/commands/new.ts",".././src/addTOTP.ts",".././src/commands/edit.ts",".././src/makeStatusBarItem.ts",".././src/commands/backup.ts",".././src/commands/restore.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","latest","persistV1","auto","storeInState","backup","ctx","globalState","STORE_VER_KEY","loadFromState","Error","backupData","JSON","parse","restore","addCode","code","allKeys","newKeys","replaceCode","newCode","map","deleteCode","filter","merge","data","ctxCodes","forEach","undefined","find","ctxCode","stringify","console","log","push","Command","addButton","iconPath","ThemeIcon","tooltip","editButton","backupButton","restoreButton","getKey_1","getKey","base32decode_1","base32decode","getCode_1","getCode","getCounter_1","getCounter","getHMAC_1","getHMAC","getTOTP_1","getTOTP","input","encoding","Buffer","isBuffer","from","b32string","length","codepoints","Array","x","indexOf","some","buf","alloc","index","array","bitOffset","startingByte","Math","floor","shiftInU16","newU8","readUInt8","writeUInt8","newU16","readUInt16BE","writeUInt16BE","hmac","nDigits","offset","readUInt32BE","pow","toString","padStart","timestamp","T0","Tx","adjustedTimestamp","remainingMs","counter","counterBuffer","writeUInt32BE","__importDefault","this","mod","crypto_1","secret","message","default","createHmac","update","digest","context","subscriptions","commands","registerCommand","NEW","totpNew","PICK","totpPick","BACKUP","totpBackup","RESTORE","totpRestore","EDIT","totpEdit","makeStatusBarItem","result","pickOTPService","button","executeCommand","info","getInfo","env","clipboard","writeText","window","showInformationMessage","Promise","resolve","reject","disposables","dispose","it","items","label","qp","createQuickPick","title","buttons","onDidChangeSelection","onDidTriggerButton","btn","onDidHide","show","totp","type","TX","prefix","remaining","seed","Date","now","_a","codes","passphrase","askForEncryptionPassword","cleartext","encrypted","encode","showInputBox","prompt","password","decode","placeHolder","crypto","scryptSync","iv","cipher","createCipheriv","final","decipher","createDecipheriv","decrypted","addTOTP","AdditionalEncodings","findNextStep","askForEncoding","askForCode","needCustomParams","askForCustomParams","askForParameters","askForName","askForPrefix","state","encodings","BASE_32","OTPAUTH_URI","pick","showQuickPick","defaultParams","id","description","detail","ignoreFocusOut","_T0","_TX","_nDigits","parseInt","v","toUpperCase","allCharacters","test","charCount","getPlaceholder","validateInput","error","step","collectInputs","pickForEdit","deleteRoutine","renameRoutine","newName","entry","RENAME","DELETE","myStatusBarItem","createStatusBarItem","StatusBarAlignment","Right","text","command","content","workspace","openTextDocument","showTextDocument","uri","showOpenDialog","openLabel","canSelectMany","canSelectFiles","fs","readFile","showErrorMessage"],"mappings":"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","file":"extension.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 12);\n","module.exports = require(\"vscode\");","import { Persist, STORE_VER_KEY } from \"../context\";\nimport { persistV1 } from \"./v1\";\nconst latest = persistV1;\nexport const auto: Persist = {\n  storeInState: latest.storeInState,\n  backup: latest.backup,\n  async loadFromState(ctx) {\n    const v = ctx.globalState.get(STORE_VER_KEY);\n    switch (v) {\n      case 1:\n        return persistV1.loadFromState(ctx);\n      default:\n        throw new Error(\"unknown version\");\n    }\n  },\n  async restore(ctx, backupData) {\n    const v = JSON.parse(backupData)[STORE_VER_KEY];\n    switch (v) {\n      case 1:\n      default:\n        return persistV1.restore(ctx, backupData);\n    }\n  },\n};\n","import { Code } from \"./index\";\nimport { ExtensionContext } from \"vscode\";\nimport { auto } from \"./versions/auto\";\nexport const STORE_VER_KEY = \"STORE_VER\";\nexport interface Persist {\n  storeInState(ctx: ExtensionContext, codes: Code[]): Promise<void>;\n  loadFromState(ctx: ExtensionContext): Promise<Code[]>;\n  backup(ctx: ExtensionContext, codes: Code[]): Promise<string>;\n  restore(ctx: ExtensionContext, backupData: string): Promise<Code[]>;\n}\n\nexport const addCode = async (ctx: ExtensionContext, code: Code) => {\n  const allKeys = await auto.loadFromState(ctx);\n  const newKeys = [code, ...allKeys];\n  await auto.storeInState(ctx, newKeys);\n};\n\nexport const replaceCode = async (\n  ctx: ExtensionContext,\n  name: string,\n  newCode: Code\n) => {\n  const allKeys = await auto.loadFromState(ctx);\n  const newKeys = allKeys.map((key) => {\n    if (key.name === name) {\n      return newCode;\n    }\n    return key;\n  });\n  await auto.storeInState(ctx, newKeys);\n};\nexport const deleteCode = async (ctx: ExtensionContext, name: string) => {\n  const allKeys = await auto.loadFromState(ctx);\n  const newKeys = allKeys.filter((key) => key.name !== name);\n  await auto.storeInState(ctx, newKeys);\n};\n\nexport const merge = async (ctx: ExtensionContext, data: Code[]) => {\n  const ctxCodes = await auto.loadFromState(ctx);\n\n  data.forEach((code) => {\n    const c = ctxCodes.find(\n      (ctxCode) => JSON.stringify(ctxCode) === JSON.stringify(code)\n    );\n\n    if (c === undefined) {\n      console.log(`merging code ${code.name}`);\n      ctxCodes.push(code);\n    }\n  });\n\n  await auto.storeInState(ctx, ctxCodes);\n};\n","export enum Command {\n  PICK = \"totp.pick\",\n  BACKUP = \"totp.backup\",\n  RESTORE = \"totp.restore\",\n  EDIT = \"totp.edit\",\n  NEW = \"totp.new\",\n}\n","import { QuickInputButton, ThemeIcon } from \"vscode\";\n\nexport const addButton: QuickInputButton = {\n  iconPath: new ThemeIcon(\"add\"),\n  tooltip: \"Add new OTP\",\n};\n\nexport const editButton: QuickInputButton = {\n  iconPath: new ThemeIcon(\"edit\"),\n  tooltip: \"Edit OTP\",\n};\nexport const backupButton: QuickInputButton = {\n  iconPath: new ThemeIcon(\"save\"),\n  tooltip: \"Backup codes\",\n};\nexport const restoreButton: QuickInputButton = {\n  iconPath: new ThemeIcon(\"folder-opened\"),\n  tooltip: \"Restore from backup\",\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar getKey_1 = require(\"./getKey\");\nexports.getKey = getKey_1.getKey;\nvar base32decode_1 = require(\"./base32decode\");\nexports.base32decode = base32decode_1.base32decode;\nvar getCode_1 = require(\"./getCode\");\nexports.getCode = getCode_1.getCode;\nvar getCounter_1 = require(\"./getCounter\");\nexports.getCounter = getCounter_1.getCounter;\nvar getHMAC_1 = require(\"./getHMAC\");\nexports.getHMAC = getHMAC_1.getHMAC;\nvar getTOTP_1 = require(\"./getTOTP\");\nexports.getTOTP = getTOTP_1.getTOTP;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base32decode_1 = require(\"./base32decode\");\nexports.getKey = function (input, encoding) {\n    if (Buffer.isBuffer(input))\n        return input;\n    if (encoding === undefined) {\n        throw new Error(\"Encoding should be provided for string inputs (any Buffer encoding or 'base32')\");\n    }\n    if (encoding === \"base32\")\n        return base32decode_1.base32decode(input);\n    return Buffer.from(input, encoding);\n};\n//# sourceMappingURL=getKey.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567\";\nvar padding = \"=\";\nexports.base32decode = function (b32string) {\n    if (b32string.length % 8)\n        throw new Error(\"input should have length of multiple of 8\");\n    var codepoints = Array.from(b32string).map(function (x) { return alphabet.indexOf(x); });\n    if (codepoints.some(function (x) { return x === -1; }))\n        throw new Error(\"Illegal characters found in input\");\n    var buf = Buffer.alloc((b32string.length * 5) / 8);\n    codepoints.forEach(function (code, index, array) {\n        // 000000001111111122222222  bytes\n        // **********OOOOO*********  third character will have these bits to it\n        // --------->                bitOffset = 2x5= 10\n        //         ->                offsetInByte = 10%8= 2\n        //          <---------------> u16\n        //                 <-------- shiftInU16 = 9\n        var bitOffset = index * 5;\n        // we need to know which byte corresponds to given bit offset\n        var startingByte = Math.floor(bitOffset / 8);\n        // we need to know how far we are into this byte\n        var offsetInByte = bitOffset % 8;\n        // we will work with u16 because our 5 bits can cross byte border and it's easier to just\n        // assume that we're working with u16s\n        var shiftInU16 = 16 - 5 - offsetInByte;\n        if (index === array.length - 1) {\n            // in case of last character startingByte would be the last one and we can't read u16\n            // anymore, in that case we will work with u8\n            var u8 = buf.readUInt8(startingByte);\n            var newU8 = u8 | code;\n            buf.writeUInt8(newU8, startingByte);\n        }\n        else {\n            var u16 = buf.readUInt16BE(startingByte);\n            var newU16 = u16 | (code << shiftInU16);\n            buf.writeUInt16BE(newU16, startingByte);\n        }\n    });\n    return buf;\n};\n//# sourceMappingURL=base32decode.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getCode = function (hmac, nDigits) {\n    var offset = hmac.readUInt8(hmac.length - 1) & 0xf;\n    var fourBytes = hmac.readUInt32BE(offset) & 0x7fffffff;\n    return (fourBytes % Math.pow(10, nDigits)).toString(10).padStart(nDigits, \"0\");\n};\n//# sourceMappingURL=getCode.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getCounter = function (timestamp, T0, Tx) {\n    var adjustedTimestamp = timestamp - T0;\n    var remainingMs = Tx - (adjustedTimestamp % Tx);\n    var counter = Math.floor(adjustedTimestamp / Tx);\n    var counterBuffer = Buffer.alloc(8, 0);\n    // TODO: use writeBigInt64BE(counter, 0) (requires node v12.something)\n    // This can wait until 2038 when 64bit time stamps become necessity\n    counterBuffer.writeUInt32BE(counter, 4);\n    return { counterBuffer: counterBuffer, remainingMs: remainingMs };\n};\n//# sourceMappingURL=getCounter.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar crypto_1 = __importDefault(require(\"crypto\"));\nexports.getHMAC = function (secret, message) {\n    return crypto_1.default\n        .createHmac(\"sha1\", secret)\n        .update(message)\n        .digest();\n};\n//# sourceMappingURL=getHMAC.js.map","module.exports = require(\"crypto\");","import { ExtensionContext, commands } from \"vscode\";\nimport { totpPick } from \"./commands/pick\";\nimport { Command } from \"./commands\";\nimport { totpNew } from \"./commands/new\";\nimport { totpEdit } from \"./commands/edit\";\nimport { makeStatusBarItem } from \"./makeStatusBarItem\";\nimport { totpBackup } from \"./commands/backup\";\nimport { totpRestore } from \"./commands/restore\";\n\nexport function activate(context: ExtensionContext) {\n  context.subscriptions.push(\n    commands.registerCommand(Command.NEW, () => totpNew(context)),\n    commands.registerCommand(Command.PICK, () => totpPick(context)),\n    commands.registerCommand(Command.BACKUP, () => totpBackup(context)),\n    commands.registerCommand(Command.RESTORE, () => totpRestore(context)),\n    commands.registerCommand(Command.EDIT, () => totpEdit(context)),\n    makeStatusBarItem()\n  );\n}\n\n// this method is called when your extension is deactivated\nexport function deactivate() {}\n","import { ExtensionContext, commands, env, window } from \"vscode\";\nimport { pickOTPService } from \"../pickOTP\";\nimport { getInfo } from \"../store/index\";\nimport { Command } from \"../commands\";\nimport { addButton, editButton, restoreButton, backupButton } from \"../buttons\";\nimport { auto } from \"../store/versions/auto\";\nexport const totpPick = async (context: ExtensionContext) => {\n  try {\n    const ctxCodes = await auto.loadFromState(context);\n    const result = await pickOTPService(ctxCodes);\n\n    if (result.button) {\n      switch (result.data) {\n        case addButton: {\n          await commands.executeCommand(Command.NEW);\n          break;\n        }\n        case editButton: {\n          await commands.executeCommand(Command.EDIT);\n          break;\n        }\n        case restoreButton: {\n          await commands.executeCommand(Command.RESTORE);\n          break;\n        }\n        case backupButton: {\n          await commands.executeCommand(Command.BACKUP);\n          break;\n        }\n      }\n    } else {\n      const info = getInfo(result.data);\n      env.clipboard.writeText(info.code);\n      window.showInformationMessage(\"Password copied to clipboard\");\n    }\n  } catch (x) {\n    // debugger;\n  }\n};\n","import { Code } from \"./store/index\";\nimport { window, QuickInputButton, QuickPickItem, Disposable } from \"vscode\";\nimport { addButton, editButton, backupButton, restoreButton } from \"./buttons\";\n\nexport type Result<TItem> =\n  | { button: true; data: QuickInputButton }\n  | { button: false; data: TItem };\n\nexport const pickOTPService = async (data: Code[]): Promise<Result<Code>> =>\n  await new Promise((resolve, reject) => {\n    const disposables: Disposable[] = [];\n    const dispose = () => disposables.forEach((it) => it.dispose());\n    type Item = QuickPickItem & { code: Code };\n    const items: Item[] = data.map((code) => ({\n      code: code,\n      label: code.name,\n    }));\n\n    const qp = window.createQuickPick<Item>();\n    disposables.push(qp);\n    qp.title = \"OTP Generator\";\n    qp.items = items;\n    qp.buttons = [addButton, editButton, backupButton, restoreButton];\n    disposables.push(\n      qp.onDidChangeSelection((items) => {\n        const data = items[0].code;\n        resolve({ button: false, data });\n        dispose();\n      }),\n      qp.onDidTriggerButton((btn) => {\n        resolve({ button: true, data: btn });\n        dispose();\n      }),\n      qp.onDidHide(() => {\n        dispose();\n        reject();\n      })\n    );\n    qp.show();\n  });\n","import { getTOTP } from \"simple-totp\";\nexport type Code = {\n  name: string;\n  secret: string;\n  prefix?: string;\n  type: BufferEncoding | \"base32\";\n  T0: number;\n  TX: number;\n  nDigits: number;\n};\n\nexport const getInfo = (code: Code) => {\n  const { totp, remainingMs } = getTOTP(\n    code.secret,\n    code.type,\n    undefined,\n    code.nDigits,\n    code.T0,\n    code.TX\n  );\n  const prefix = code.prefix || \"\";\n  const remaining = Math.floor(remainingMs / 1000)\n    .toString(10)\n    .padStart(2, \"0\");\n  return { code: `${prefix}${totp}`, remaining, name: code.name };\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar getCode_1 = require(\"./getCode\");\nvar getCounter_1 = require(\"./getCounter\");\nvar getHMAC_1 = require(\"./getHMAC\");\nvar getKey_1 = require(\"./getKey\");\nexports.getTOTP = function (seed, encoding, timestamp, nDigits, T0, Tx) {\n    if (timestamp === void 0) { timestamp = Date.now(); }\n    if (nDigits === void 0) { nDigits = 6; }\n    if (T0 === void 0) { T0 = 0; }\n    if (Tx === void 0) { Tx = 30000; }\n    var secret = getKey_1.getKey(seed, encoding);\n    var _a = getCounter_1.getCounter(timestamp, T0, Tx), counterBuffer = _a.counterBuffer, remainingMs = _a.remainingMs;\n    var hmac = getHMAC_1.getHMAC(secret, counterBuffer);\n    var totp = getCode_1.getCode(hmac, nDigits);\n    return { totp: totp, remainingMs: remainingMs };\n};\n//# sourceMappingURL=getTOTP.js.map","import { Persist, STORE_VER_KEY } from \"../context\";\nimport { Code } from \"../index\";\nimport { askForEncryptionPassword } from \"../askForEncryptionPassword\";\nimport { window } from \"vscode\";\nimport { encode, decode } from \"../crypto\";\nconst KEY = \"TOTP\";\nconst STORE_VER = 1;\nexport const persistV1: Persist = {\n  async storeInState(ctx, codes) {\n    ctx.globalState.update(KEY, codes);\n    ctx.globalState.update(STORE_VER_KEY, STORE_VER);\n  },\n  async loadFromState(ctx) {\n    return ctx.globalState.get<Code[]>(KEY, []);\n  },\n  async backup(ctx, data) {\n    const passphrase = await askForEncryptionPassword();\n    if (passphrase === undefined) {\n      throw new Error(\"passphrase dialog aborted\");\n    }\n    if (passphrase === \"\") {\n      return JSON.stringify({ cleartext: data });\n    } else {\n      return JSON.stringify({\n        encrypted: encode(JSON.stringify(data), passphrase),\n      });\n    }\n  },\n  async restore(ctx, backupData) {\n    let passphrase;\n    const { cleartext, encrypted } = JSON.parse(backupData);\n    const codes: Code[] = [];\n    if (cleartext !== undefined) {\n      codes.push(...cleartext);\n    }\n    if (encrypted !== undefined) {\n      passphrase = await window.showInputBox({\n        prompt: \"Enter password used for encryption\",\n        password: true,\n      });\n      if (!passphrase) {\n        throw new Error(\"No passphrase was supplied\");\n      }\n      codes.push(...JSON.parse(decode(encrypted, passphrase)));\n    }\n\n    return codes;\n  },\n};\n","import { window } from \"vscode\";\nexport const askForEncryptionPassword = async () => {\n  const passphrase = await window.showInputBox({\n    prompt: \"Enter encryption password\",\n    password: true,\n    placeHolder: \"Leave this empty if you don't want to encrypt (UNSAFE)\",\n  });\n  return passphrase;\n};\n","import * as crypto from \"crypto\";\nconst EXPORT_ENCODING = \"hex\";\nconst ALGORITHM = \"aes-192-cbc\";\n\nexport const encode = (data: string, passphrase: string) => {\n  // Use the async `crypto.scrypt()` instead.\n  const key = crypto.scryptSync(passphrase, \"salt\", 24);\n  // Use `crypto.randomBytes` to generate a random iv instead of the static iv\n  // shown here.\n  const iv = Buffer.alloc(16, 0); // Initialization vector.\n\n  const cipher = crypto.createCipheriv(ALGORITHM, key, iv);\n\n  let encrypted = cipher.update(data, \"utf8\", EXPORT_ENCODING);\n  encrypted += cipher.final(EXPORT_ENCODING);\n  return encrypted;\n};\n\nexport const decode = (data: string, passphrase: string) => {\n  // Use the async `crypto.scrypt()` instead.\n  const key = crypto.scryptSync(passphrase, \"salt\", 24);\n  // Use `crypto.randomBytes` to generate a random iv instead of the static iv\n  // shown here.\n  const iv = Buffer.alloc(16, 0); // Initialization vector.\n\n  const decipher = crypto.createDecipheriv(ALGORITHM, key, iv);\n\n  let decrypted = decipher.update(data, EXPORT_ENCODING, \"utf8\");\n  decrypted += decipher.final(\"utf8\");\n  return decrypted;\n  // Prints: some clear text data\n};\n","import { ExtensionContext } from \"vscode\";\nimport { addTOTP } from \"../addTOTP\";\nimport { addCode } from \"../store/context\";\nexport const totpNew = async (context: ExtensionContext) => {\n  const code = await addTOTP(context);\n  addCode(context, code);\n};\n","import { QuickPickItem, ExtensionContext, window } from \"vscode\";\nimport { base32decode } from \"simple-totp\";\nimport { Code } from \"./store/index\";\n\nenum AdditionalEncodings {\n  BASE_32 = \"base32\",\n  OTPAUTH_URI = \"otpauth:// TOTP key\",\n}\n\ninterface State {\n  encoding: BufferEncoding | AdditionalEncodings;\n  key: Buffer;\n  T0: number;\n  TX: number;\n  nDigits: number;\n  prefix: string;\n  name: string;\n  needCustomParams: boolean;\n}\n\ntype PartialStateResolver = (\n  s: Partial<State>\n) => Promise<Partial<State>> | Partial<State>;\n\nconst isFullState = (s: Partial<State>): s is State => {\n  if (s.T0 === undefined) {\n    return false;\n  }\n  if (s.TX === undefined) {\n    return false;\n  }\n  if (s.encoding === undefined) {\n    return false;\n  }\n  if (s.key === undefined) {\n    return false;\n  }\n  if (s.nDigits === undefined) {\n    return false;\n  }\n  if (s.name === undefined) {\n    return false;\n  }\n  if (s.prefix === undefined) {\n    return false;\n  }\n  if (s.needCustomParams === undefined) {\n    return false;\n  }\n  return true;\n};\n\nconst findNextStep = (s: Partial<State>): PartialStateResolver | null => {\n  if (s.encoding === undefined) {\n    return askForEncoding;\n  }\n  if (s.key === undefined) {\n    return askForCode;\n  }\n  if (s.T0 === undefined || s.TX === undefined || s.nDigits === undefined) {\n    if (s.needCustomParams === true) {\n      return askForCustomParams;\n    }\n    return askForParameters;\n  }\n  if (s.name === undefined) {\n    return askForName;\n  }\n  if (s.prefix === undefined) {\n    return askForPrefix;\n  }\n  return null;\n};\n\nconst askForEncoding = async (\n  state: Partial<State>\n): Promise<Partial<State>> => {\n  const encodings = [\n    { label: AdditionalEncodings.BASE_32 },\n    { label: \"hex\" },\n    { label: \"ascii\" },\n    { label: AdditionalEncodings.OTPAUTH_URI },\n  ];\n  const pick = await window.showQuickPick(encodings, {\n    placeHolder: \"Which encoding does your seed have\",\n  });\n  return { ...state, encoding: pick?.label as State[\"encoding\"] | undefined };\n};\n\nconst askForParameters = async (\n  state: Partial<State>\n): Promise<Partial<State>> => {\n  const defaultParams = Symbol();\n  const customParams = Symbol();\n  type TItem = QuickPickItem & { id: symbol };\n  const items: TItem[] = [\n    {\n      id: defaultParams,\n      label: \"Use default parameters\",\n      description: \"T₀ = 0, 30 seconds interval, 6 digits\",\n      detail: \"T₀ = 0, 30 seconds interval, 6 digits\",\n    },\n    { label: \"Custom parameters...\", id: customParams },\n  ];\n\n  const pick = await window.showQuickPick(items, {\n    placeHolder: \"Optional parameters\",\n  });\n\n  if (pick === undefined) {\n    return state;\n  }\n  if (pick.id === defaultParams) {\n    return { ...state, T0: 0, TX: 30, nDigits: 6, needCustomParams: false };\n  }\n  return { ...state, needCustomParams: true };\n};\n\nconst askForName = async (state: Partial<State>): Promise<Partial<State>> => {\n  const name = await window.showInputBox({\n    prompt: \"Name of token\",\n    placeHolder: \"Name of token\",\n    ignoreFocusOut: true,\n  });\n  return { ...state, name };\n};\n\nconst askForPrefix = async (state: Partial<State>): Promise<Partial<State>> => {\n  const prefix = await window.showInputBox({\n    prompt: \"prefix of token\",\n    placeHolder: \"prefix\",\n    ignoreFocusOut: true,\n  });\n  return { ...state, prefix };\n};\n\nconst askForCustomParams = async (\n  state: Partial<State>\n): Promise<Partial<State>> => {\n  const _T0 = await window.showInputBox({\n    placeHolder: \"Initial timestamp\",\n    value: \"0\",\n    ignoreFocusOut: true,\n  });\n  const _TX = await window.showInputBox({\n    placeHolder: \"Interval length (seconds)\",\n    value: \"30\",\n    ignoreFocusOut: true,\n  });\n  const _nDigits = await window.showInputBox({\n    placeHolder: \"Interval length (seconds)\",\n    value: \"6\",\n    ignoreFocusOut: true,\n  });\n\n  return {\n    ...state,\n    T0: _T0 ? parseInt(_T0, 10) : undefined,\n    TX: _TX ? parseInt(_TX, 10) : undefined,\n    nDigits: _nDigits ? parseInt(_nDigits, 10) : undefined,\n  };\n};\n\nconst askForCode = async (state: Partial<State>): Promise<Partial<State>> => {\n  const getPlaceholder = () => {\n    if (state.encoding === AdditionalEncodings.OTPAUTH_URI) {\n      return \"otpauth://\";\n    }\n  };\n\n  const decode = (v: string) => {\n    switch (state.encoding) {\n      case AdditionalEncodings.BASE_32:\n        return base32decode(v.toUpperCase());\n      case AdditionalEncodings.OTPAUTH_URI:\n        throw new Error(\"No decoder\");\n      case \"hex\":\n        const allCharacters = /^[0-9a-h]+$/i.test(v);\n        const charCount = v.length % 2 === 0;\n        if (!allCharacters) {\n          throw new Error(\n            \"Check that all characters are in 0-9,a-h range (case insensitive)\"\n          );\n        }\n        if (!charCount) {\n          throw new Error(\"Input length is uneven\");\n        }\n        return Buffer.from(v, \"hex\");\n      case \"ascii\":\n        const buf = Buffer.from(v, \"ascii\");\n        if (buf.toString(\"ascii\") !== v) {\n          throw new Error(\"Not all characters are in ascii range\");\n        }\n        return buf;\n      default:\n        throw new Error(\"Encoding is undefined\");\n    }\n  };\n  const key = await window.showInputBox({\n    prompt: \"Paste your code\",\n    placeHolder: getPlaceholder(),\n    ignoreFocusOut: true,\n    validateInput: (v) => {\n      try {\n        decode(v);\n      } catch (error) {\n        return error.message;\n      }\n    },\n  });\n  if (key !== undefined) {\n    return { ...state, key: decode(key) };\n  }\n  throw new Error(\"Key is undefined\");\n};\n\nexport async function addTOTP(context: ExtensionContext) {\n  async function collectInputs() {\n    let state = {};\n\n    while (!isFullState(state)) {\n      const step = findNextStep(state);\n      if (step === null) {\n        throw new Error(\"no steps\");\n      }\n      state = await step(state);\n    }\n\n    return state;\n  }\n\n  const state = await collectInputs();\n  const code: Code = {\n    name: state.name,\n    secret: state.key.toString(\"hex\"),\n    type: \"hex\",\n    prefix: state.prefix,\n    T0: state.T0,\n    // state.TX is in seconds, Code['TX'] is in milliseconds\n    TX: state.TX * 1000,\n    nDigits: state.nDigits,\n  };\n  window.showInformationMessage(`Creating Application Service '${state.name}'`);\n  return code;\n}\n","import {\n  ExtensionContext,\n  window,\n  QuickPickItem,\n  Disposable,\n  commands,\n} from \"vscode\";\nimport { replaceCode, deleteCode } from \"../store/context\";\nimport { Result } from \"../pickOTP\";\nimport { Code } from \"../store/index\";\nimport { Command } from \"../commands\";\nimport { auto } from \"../store/versions/auto\";\n\nexport const pickForEdit = async (data: Code[]): Promise<Result<Code>> => {\n  return await new Promise((resolve, reject) => {\n    const disposables: Disposable[] = [];\n    const dispose = () => disposables.forEach((it) => it.dispose());\n    type Item = QuickPickItem & { code: Code };\n    const items: Item[] = data.map((code) => ({\n      code: code,\n      label: code.name,\n    }));\n\n    const qp = window.createQuickPick<Item>();\n    disposables.push(qp);\n    qp.title = \"Select item to edit\";\n    qp.items = items;\n\n    disposables.push(\n      qp.onDidChangeSelection((items) => {\n        const data = items[0].code;\n        resolve({ button: false, data });\n        dispose();\n      }),\n      qp.onDidHide(() => {\n        dispose();\n        reject();\n      })\n    );\n    qp.show();\n  });\n};\nexport const deleteRoutine = async (context: ExtensionContext, code: Code) => {\n  const confirmation = await window.showInputBox({\n    placeHolder: `Please type \"${code.name}\" to confirm deletion`,\n    prompt: `Before deleting this account, make sure that you have other means of generating codes for it`,\n  });\n  if (confirmation === code.name) {\n    deleteCode(context, code.name);\n  }\n};\nexport const renameRoutine = async (context: ExtensionContext, code: Code) => {\n  const newName = await window.showInputBox({\n    prompt: `Enter new name for ${code.name}`,\n    value: code.name,\n  });\n  if (newName === undefined) {\n    return;\n  }\n  replaceCode(context, code.name, { ...code, name: newName });\n};\nexport const totpEdit = async (context: ExtensionContext) => {\n  try {\n    const data = await auto.loadFromState(context);\n    const entry = await pickForEdit(data);\n    if (entry.button) {\n      return;\n    }\n    const code = entry.data;\n    const RENAME = { label: \"Rename\" };\n    const DELETE = { label: \"Delete\" };\n    const result = await window.showQuickPick([RENAME, DELETE]);\n    if (!result) {\n      return;\n    }\n    if (result === RENAME) {\n      await renameRoutine(context, code);\n    }\n    if (result === DELETE) {\n      await deleteRoutine(context, code);\n    }\n\n    await commands.executeCommand(Command.PICK);\n  } catch (x) {\n    // debugger;\n  }\n};\n","import { ExtensionContext, window, StatusBarAlignment } from \"vscode\";\nimport { Command } from \"./commands\";\nexport const makeStatusBarItem = () => {\n  const myStatusBarItem = window.createStatusBarItem(\n    StatusBarAlignment.Right,\n    100\n  );\n\n  myStatusBarItem.show();\n  myStatusBarItem.text = \"$(key)\";\n  myStatusBarItem.command = Command.PICK;\n  return myStatusBarItem;\n};\n","import { ExtensionContext, window, workspace } from \"vscode\";\nimport { auto } from \"../store/versions/auto\";\n\nexport const totpBackup = async (context: ExtensionContext) => {\n  try {\n    const codes = await auto.loadFromState(context);\n    const content = await auto.backup(context, codes);\n\n    const d = await workspace.openTextDocument({ content });\n    window.showTextDocument(d);\n    window.showInformationMessage(\n      \"Save this document somewhere and don't forge the passphrase!\"\n    );\n  } catch (x) {\n    // debugger;\n  }\n};\n","import { ExtensionContext, window, workspace } from \"vscode\";\nimport { merge, Persist } from \"../store/context\";\n\nimport { auto } from \"../store/versions/auto\";\n\nexport const totpRestore = async (context: ExtensionContext) => {\n  try {\n    const uri = await window.showOpenDialog({\n      openLabel: \"Restore seeds\",\n      canSelectMany: false,\n      canSelectFiles: true,\n    });\n    if (!uri) {\n      return;\n    }\n    const data = await workspace.fs.readFile(uri[0]);\n    const backupData = data.toString();\n    const codes = await auto.restore(context, backupData);\n\n    if (codes.length !== 0) {\n      merge(context, codes);\n      window.showInformationMessage(\n        `${codes.length} passwords have been imported`\n      );\n    }\n  } catch (x) {\n    window.showErrorMessage(\n      `An error occured during decryption: \\n${x.message}`\n    );\n  }\n};\n"],"sourceRoot":""}